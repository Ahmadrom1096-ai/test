<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Ujian Seleksi</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    h2 { border-bottom: 2px solid #ccc; }
    .soal { margin-bottom: 20px; }
  </style>
</head>
<body>
  <h1>Ujian Seleksi</h1>
  <p id="info">Memuat soal...</p>
  <form id="ujianForm" style="display:none;">
    <div id="soalTeknis"></div>
    <div id="soalPsikologi"></div>
    <button type="submit">Kirim Jawaban</button>
  </form>

  <script>
    // === CONFIG ===
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyqgydOPSl75_yBOS3R4S2c5pZYnYN45xKTULx9kKopV-8HnANW-oiO_U90G9EjKHttnw/exec';

    // === AMBIL TOKEN ===
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');

    if (!token) {
      document.getElementById('info').innerText = 'Token tidak ditemukan di URL.';
      throw new Error('Token tidak ada.');
    }

    // === AMBIL SOAL ===
    fetch(`${SCRIPT_URL}?token=${token}`)
      .then(res => res.json())
      .then(data => {
        if (data.status !== 'success') {
          document.getElementById('info').innerText = 'Gagal memuat soal: ' + data.message;
          return;
        }

        document.getElementById('info').style.display = 'none';
        document.getElementById('ujianForm').style.display = 'block';

        renderSoal('Teknis', data.data['Soal Teknis'], 'soalTeknis');
        renderSoal('Psikologi', data.data['Soal Psikologi'], 'soalPsikologi');

      })
      .catch(err => {
        console.error(err);
        document.getElementById('info').innerText = 'Error: ' + err.message;
      });

    // === RENDER SOAL ===
    function renderSoal(judul, soalArray, targetId) {
      const container = document.getElementById(targetId);
      const sectionTitle = document.createElement('h2');
      sectionTitle.innerText = `Soal ${judul}`;
      container.appendChild(sectionTitle);

      soalArray.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'soal';

        const p = document.createElement('p');
        p.innerHTML = `${item.question_number}. ${item.question_text}`;
        div.appendChild(p);

        ['A','B','C','D'].forEach(opt => {
          const label = document.createElement('label');
          label.innerHTML = `<input type="radio" name="${judul}_${index}" value="${opt}" required> ${opt}. ${item.options[opt]}`;
          div.appendChild(label);
          div.appendChild(document.createElement('br'));
        });

        container.appendChild(div);
      });
    }

    // === HANDLE SUBMIT ===
    document.getElementById('ujianForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const jawabanTeknis = [];
      const jawabanPsikologi = [];

      const teknisInputs = document.querySelectorAll('input[name^="Teknis_"]:checked');
      teknisInputs.forEach(input => jawabanTeknis.push(input.value));

      const psikologiInputs = document.querySelectorAll('input[name^="Psikologi_"]:checked');
      psikologiInputs.forEach(input => jawabanPsikologi.push(input.value));

      const payload = {
        token: token,
        jawaban_teknis: jawabanTeknis,
        jawaban_psikologi: jawabanPsikologi
      };

      console.log('Kirim:', payload);

      fetch(SCRIPT_URL, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(result => {
        if (result.status === 'sukses') {
          alert('Jawaban berhasil disimpan! Terima kasih.');
          window.location.href = 'https://ahmadrom1096-ai.github.io/test/selesai.html'; // opsional: redirect halaman selesai
        } else {
          alert('Gagal menyimpan: ' + result.message);
        }
      })
      .catch(err => {
        console.error(err);
        alert('Error: ' + err.message);
      });
    });
  </script>
</body>
</html>
