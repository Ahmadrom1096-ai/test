<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Ujian Online - Shankara Group</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
    .soal { margin-bottom: 30px; }
    .btn-kirim { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
    .btn-kirim:hover { background-color: #45a049; }
  </style>
</head>
<body>

  <h2>Ujian Tulis Shankara Group</h2>
  <div id="soal-container"></div>

  <button id="submit-button" class="btn-kirim">Kirim Jawaban</button>

  <script>
    const token = new URLSearchParams(window.location.search).get("token");

    if (!token) {
      alert("Token tidak ditemukan di URL.");
      throw new Error("Token not found.");
    }

    // âœ… Ambil soal dari endpoint Apps Script
    fetch("https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec?token=" + token)
      .then(res => res.json())
      .then(data => {
        if (data.status !== "success") {
          alert("Gagal mengambil soal.");
          return;
        }

        renderSoal("teknis", data.soal_teknis);
        renderSoal("psikologi", data.soal_psikologi);
      });

    function renderSoal(prefix, list) {
      const container = document.getElementById("soal-container");
      list.forEach((item, i) => {
        const nomor = i + 1;
        const div = document.createElement("div");
        div.className = "soal";
        div.innerHTML = `
          <p><strong>${prefix.toUpperCase()} ${nomor}:</strong> ${item.question}</p>
          ${item.options.map(opt => `
            <label><input type="radio" name="${prefix}-${nomor}" value="${opt}"> ${opt}</label><br>
          `).join('')}
        `;
        container.appendChild(div);
      });
    }

    function getJawaban(prefix) {
      const jawaban = [];
      let i = 1;
      while (true) {
        const el = document.querySelector(`input[name="${prefix}-${i}"]:checked`);
        if (!el) break;
        jawaban.push(el.value);
        i++;
      }
      return jawaban;
    }

    document.getElementById("submit-button").addEventListener("click", function () {
      const answers_teknis = getJawaban("teknis");
      const answers_psikologi = getJawaban("psikologi");

      if (answers_teknis.length === 0 || answers_psikologi.length === 0) {
        alert("Mohon isi semua soal sebelum mengirim jawaban.");
        return;
      }

      fetch("https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec", {
        method: "POST",
        body: JSON.stringify({
          token: token,
          answers_teknis: answers_teknis,
          answers_psikologi: answers_psikologi
        }),
        headers: {
          "Content-Type": "application/json"
        }
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === "success") {
          alert(`Jawaban berhasil dikirim!\nSkor Teknis: ${data.skor_teknis}\nSkor Psikologi: ${data.skor_psikologi}`);
          window.location.href = "https://thankyou-page.com"; // ganti jika perlu
        } else {
          alert("Gagal menyimpan jawaban: " + data.message);
        }
      })
      .catch(err => {
        alert("Terjadi kesalahan saat mengirim.");
        console.error(err);
      });
    });
  </script>

</body>
</html>
